DROP TABLE IF EXISTS FLOOD.TOUCHINGBUILDINGS CASCADE;


CREATE TABLE FLOOD.TOUCHINGBUILDINGS AS
-- with help from https://gis.stackexchange.com/a/187814/114009
SELECT 1 MULTIROOF,
	B1.BLDGTYPE,
	B1.BUILDYEAR, (ST_DUMP(ST_UNION(B1.GEOM))).GEOM
FROM FLOOD.BUILDINGS B1,
	FLOOD.BUILDINGS B2
WHERE ST_INTERSECTS(B1.GEOM, B2.GEOM)
	AND B1.ID <> B2.ID
GROUP BY B1.BLDGTYPE,
	B1.BUILDYEAR;


CREATE INDEX IF NOT EXISTS TOUCHING_BUILDINGS_GEOM_IDX ON FLOOD.TOUCHINGBUILDINGS USING GIST(GEOM);